---
title: (译)在分布式支付系统中避免多次扣费
categories: Draft
date: 2023-10-11 17:55:10
updated: 2023-10-11 17:55:10
tags: [Reading, 中文]
---

{% note info %}
翻译自 Airbnb 支付团队的 Jon Chew 和 Ninad Khisti 于 2019 年 4 月 17 日发表在 The Airbnb Tech Blog 的文章
<!-- more -->
原文链接: [https://medium.com/airbnb-engineering/avoiding-double-payments-in-a-distributed-payments-system-2981f6b070bb](https://medium.com/airbnb-engineering/avoiding-double-payments-in-a-distributed-payments-system-2981f6b070bb)
{% endnote %}

## 背景

Airbnb 把它的基础设施迁移到了一套 [SOA (Service-Oriented Architecture, 面向服务的架构)](https://medium.com/airbnb-engineering/building-services-at-airbnb-part-2-142be1c5d506) 上。尽管 SOA 有使开发者专注于自己的服务并且加快迭代的优点，但它却给账单和支付应用带来了挑战。这是因为，SOA 难于维护数据的完整性。处理一个请求的过程，就像处理复杂的分布式事务一样，它会被传递给下游的服务，每个经过的服务都可能会更改它的状态，或者对它有负面的影响。

为了在所有服务之间实现[一致性](https://zh.wikipedia.org/wiki/%E4%B8%80%E8%87%B4%E6%80%A7_(%E6%95%B0%E6%8D%AE%E5%BA%93))，可以使用一些协议，比如[二阶段提交](https://zh.wikipedia.org/zh-cn/%E4%BA%8C%E9%98%B6%E6%AE%B5%E6%8F%90%E4%BA%A4#:~:text=%E4%BA%8C%E9%98%B6%E6%AE%B5%E6%8F%90%E4%BA%A4%EF%BC%88%E8%8B%B1%E8%AF%AD%EF%BC%9ATwo,%E4%B8%80%E7%A7%8D%E5%8D%8F%E8%AE%AE%EF%BC%88Protocol%EF%BC%89%E3%80%82)（two-phase commit）。但